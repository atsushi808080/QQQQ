<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./bootstrap.css">
    <style>
        .carousel-control-prev,
        .carousel-control-next {
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <div>
        <div id="displayColor">顏色:</div>
        <div id="displayStorage">儲存容量:</div>
        <div id="displayNetwork">連線能力:</div>
        <div id="displayPrice">價格:</div>
        <div class="card justify-content-center" id="pic" style="width: 400px;">
            <!-- <img id="displayImg" src="./blue.jpg" class="card-img-top img-fluid" alt="..."> -->
            <div id="carouselExample" class="carousel slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="./blue.jpg" class="ipad d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="./gray.jpg" class="ipad d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="./pink.jpg" class="ipad d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="./purple.jpg" class="ipad d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="./starlight.jpg" class="ipad d-block w-100" alt="...">
                    </div>
                </div>
                <button class="carousel-control-prev " type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
            <!-- ----------------------------------- -->
            <template id="tempLateImg">
                <div id="carouselExample" class="carousel slide">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="./blue.jpg" class="ipad d-block w-100" alt="...">
                        </div>
                        <div class="carousel-item">
                            <img src="./blue-1.jpg" class="ipad d-block w-100" alt="...">
                        </div>
                        <div class="carousel-item">
                            <img src="./blue-2.jpg" class="ipad d-block w-100" alt="...">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </template>
    
            <!-- -------------------------------------------- -->
        </div>
    
        <br>
        <button class="btn btn-dark buttonColor" id="blue" value="blue.jpg">藍色</button>
        <button class="btn btn-dark buttonColor" id="gray" value="gray.jpg">太空灰色</button>
        <button class="btn btn-dark buttonColor" id="pink" value="pink.jpg">粉紅色</button>
        <button class="btn btn-dark buttonColor" id="purple" value="purple.jpg">紫色</button>
        <button class="btn btn-dark buttonColor" id="starlight" value="starlight.jpg">星光色</button>
        <br><br>
        <button class="btn btn-dark buttonStorage" id="storage64GB" value="64GB">64GB</button>
        <button class="btn btn-dark buttonStorage" id="storage256GB" value="256GB">256GB</button>
        <br>
        <br>
        <button class="btn btn-dark buttonNetwork" id="Wi-Fi" value="Wi-Fi">Wi-Fi</button>
        <button class="btn btn-dark buttonNetwork" id="Cellular" value="Cellular">Wi-Fi+行動網路</button>
        <span>test:</span>
    </div>
    <div id="msg"></div>


    <script src="./bootstrap.js"></script>
    <script>
        const url = "https://raw.githubusercontent.com/atsushi808080/FileStorage/main/appleair2023";

        let ipadArray = [];
        let filterArray = [];
        let _color, ipadArr, _colorUrl, ipadNode, _storage, _network, _network2, ipadImg1;

        let ipadImg = [
            { color1: "gray.jpg", color2: "gray-1.jpg", color3: "gray-2.jpg" },
            { color1: "blue.jpg", color2: "blue-1.jpg", color3: "blue-2.jpg" },
            { color1: "pink.jpg", color2: "pink-1.jpg", color3: "pink-2.jpg" },
            { color1: "purple.jpg", color2: "purple-1.jpg", color3: "purple-2.jpg" },
            { color1: "starlight.jpg", color2: "starlight-1.jpg", color3: "starlight-2.jpg" },
        ];

        const buttonColor = document.querySelectorAll(".buttonColor");
        const buttonStorage = document.querySelectorAll(".buttonStorage");
        const buttonNetwork = document.querySelectorAll(".buttonNetwork");
        const displayColor = document.getElementById("displayColor");
        const displayStorage = document.getElementById("displayStorage");
        const displayNetwork = document.getElementById("displayNetwork");
        const displayPrice = document.getElementById("displayPrice");
        // const displayImg = document.getElementById("displayImg");
        const tempLateImg = document.getElementById("tempLateImg");
        const pic = document.getElementById("pic");

        buttonStorage.forEach(item => {
            item.disabled = true;
        })

        buttonNetwork.forEach(item => {
            item.disabled = true;
        })


        function clickColor() {
            let clickedButton = event.target;

            let count = 0;
            clickedButton.disabled = true;
            buttonColor.forEach(item => {
                if (item !== clickedButton) {
                    item.disabled = false;
                }
                if (item.disabled == true) {
                    buttonStorage.forEach(item1 => {
                        if (item1.disabled == false) {
                            return;
                        }
                        if (item1.disabled == true) {
                            count++;
                        }
                        if (count > 1) {
                            buttonStorage.forEach(item => {
                                item.disabled = false;
                            });
                        }

                    })
                }

            });
        }

        function clickStorage() {
            let clickedButton = event.target;

            let count = 0;
            clickedButton.disabled = true;
            buttonStorage.forEach(item => {
                if (item !== clickedButton) {
                    item.disabled = false;
                }
                if (item.disabled == true) {
                    buttonNetwork.forEach(item1 => {
                        if (item1.disabled == false) {
                            return;
                        }
                        if (item1.disabled == true) {
                            count++;
                        }
                        if (count > 1) {
                            buttonNetwork.forEach(item => {
                                item.disabled = false;
                            });
                        }

                    })
                }
            });
        }

        function clickNetwork() {
            let clickedButton = event.target;

            clickedButton.disabled = true;
            buttonNetwork.forEach(item => {
                if (item !== clickedButton) {
                    item.disabled = false;
                }
            });
        }

        window.onload = () => {

            getIpadJson();

            buttonColor.forEach(item => {
                item.addEventListener('click', event => {
                    pic.innerHTML = "";
                    clickColor();
                    _color = event.target.innerText;
                    // _colorUrl = event.target.value;
                    displayColor.innerText = `顏色:${_color}`;
                    console.log(_color);
                    // console.log(_colorUrl);
                    // _colorUrl = ipadArray.filter(x => x.picture == _colorUrl);
                    // console.log(_colorUrl)
                    // displayImg.src = `./${_colorUrl[0].picture}`;
                    filterArray = ipadArray.filter(x => x.color == _color);
                    console.log(filterArray)
                    ipadNode = tempLateImg.content.cloneNode(true);
                    let ipad = ipadNode.querySelectorAll(".ipad");

                    ipadImg1 = ipadImg.filter(item1 => item1.color1 == event.target.value);
                    ipadArr = Object.values(ipadImg1[0])
                    ipad.forEach((x, index) => {
                        x.src = `./${ipadArr[index]}`;
                    })
                    pic.append(ipadNode)
                    findIpads();

                })
            })



            buttonStorage.forEach(item => {
                item.addEventListener('click', event => {
                    clickStorage();
                    _storage = event.target.innerText;
                    displayStorage.innerText = `儲存容量:${_storage}`;
                    console.log(_storage)
                    findIpads()
                })
            })

            buttonNetwork.forEach(item => {
                item.addEventListener('click', event => {
                    clickNetwork();
                    _network = event.target.value;
                    _network2 = event.target.innerText;
                    displayNetwork.innerText = `連線能力:${_network2}`;
                    console.log(_network)
                    findIpads()
                    
                })
            })


        };

        function getIpadJson() {
            let xhr = new XMLHttpRequest();
            xhr.onload = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log(`HTTP請求成功`);
                    // ipadArray = JSON.parse(this.responseText);
                    ipadArray = this.response;
                }
                else {
                    console.log("HTTP請求失敗");
                }

            };

            xhr.open("GET", url);
            xhr.responseType = "json"
            xhr.send();
        }

        function findIpads() {
            msg.innerHTML = "";
            if (typeof _color !== "string" || typeof _storage !== "string" || typeof _network !== "string") {
                return;
            }
            console.log("OK");
            filterArray = ipadArray.filter(x => x.color == _color && x.storage == _storage && x.network == _network);
            console.log(filterArray[0])
            displayPrice.innerText = `價格:${filterArray[0].price}`;

            filterArray.forEach((x,index)=>{
                        msg.innerHTML += `${JSON.stringify(x)}<br>`;
                    })
        }


    </script>
</body>

</html>